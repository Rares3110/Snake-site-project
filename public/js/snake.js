var levelsSnake = 
[
    [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ],
    [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ],
    [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1],
        [1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
        [1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ],
    [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1],
        [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
        [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
        [1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
        [1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1],
        [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
        [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
        [1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ],
    [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ]
];

function EmptyCells ()
{
    this.coada = [];
    this.getRandom = function()
    {
        if(this.coada.length === 0)
            return -1;

        var poz = Math.floor(Math.random() * this.coada.length);
        var coord = this.coada[poz];
        this.coada[poz] = this.coada[this.coada.length - 1];
        this.coada.pop();
        return coord;
    }
    this.pushInQueue = function(coord)
    {
        this.coada.push(coord);
    }
    this.removeFromQueue = function(coord)
    {
        for(var i = 0; i < this.coada.length; i++)
            if(this.coada[i][0] === coord[0] && this.coada[i][1] === coord[1])
            {
                this.coada[i] = this.coada[this.coada.length - 1];
                this.coada.pop();
                return;
            }
    }
    this.getLength = function()
    {
        return this.coada.length;
    }
}

var snakeObjects =
[
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ],
    [ [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [] ]
];
function AddStar(coord, canGlow)
{
    var board = document.getElementById("snakeBoard");
    var newStar = document.createElement("img");
    newStar.src = "images/goldenStar.png";
    newStar.className = "star";
    newStar.style.gridRow = coord[0];
    newStar.style.gridColumn = coord[1];
    newStar.alt = "star image";

    if(canGlow == true)
    {
        newStar.style.boxShadow = "var(--glowStar)";
    }

    snakeObjects[coord[0]][coord[1]].push(newStar);
    board.appendChild(newStar);
}
function AddLevelStar(coord)
{
    var board = document.getElementById("snakeBoard");
    var newStar = document.createElement("img");
    newStar.src = "images/levelStar.png";
    newStar.className = "star";
    newStar.style.gridRow = coord[0];
    newStar.style.gridColumn = coord[1];
    newStar.alt = "level star image";
    newStar.style.boxShadow = "var(--glowLevelStar)";
    snakeObjects[coord[0]][coord[1]].push(newStar);
    board.appendChild(newStar);
}
function AddSnakeChange(coord, rotation)
{
    var board = document.getElementById("snakeBoard");
    var bigPart = document.createElement("div");
    bigPart.style.width = 100 + "%";
    bigPart.style.height = 100 + "%";
    bigPart.style.display = "grid";
    bigPart.style.gridRow = coord[0];
    bigPart.style.gridColumn = coord[1];

    var part1 = document.createElement("div");
    part1.className = "snakePartChange1";
    part1.style.gridRow = 1;
    part1.style.gridColumn = 1;
    bigPart.appendChild(part1);

    var part2 = document.createElement("div");
    part2.className = "snakePartChange2";
    part2.style.gridRow = 1;
    part2.style.gridColumn = 1;
    bigPart.appendChild(part2);

    var part3 = document.createElement("div");
    part3.className = "snakePartChange3";
    part3.style.gridRow = 1;
    part3.style.gridColumn = 1;
    bigPart.appendChild(part3);

    snakeObjects[coord[0]][coord[1]].push(bigPart);
    bigPart.style.transform = "rotate(" + rotation + "deg)";
    board.appendChild(bigPart);
}
function AddSnakeStraight(coord, rotation)
{
    var board = document.getElementById("snakeBoard");
    var part = document.createElement("div");
    part.className = "snakePartStraight";
    part.style.gridRow = coord[0];
    part.style.gridColumn = coord[1];
    snakeObjects[coord[0]][coord[1]].push(part);
    part.style.transform = "rotate(" + rotation + "deg)";
    board.appendChild(part);
}
function AddSnakeTail(coord, rotation)
{
    var board = document.getElementById("snakeBoard");
    var bigPart = document.createElement("div");
    bigPart.style.width = 100 + "%";
    bigPart.style.height = 100 + "%";
    bigPart.style.display = "grid";
    bigPart.style.gridRow = coord[0];
    bigPart.style.gridColumn = coord[1];

    var part1 = document.createElement("div");
    part1.className = "snakePartTail1";
    part1.style.gridRow = 1;
    part1.style.gridColumn = 1;
    bigPart.appendChild(part1);

    var part2 = document.createElement("div");
    part2.className = "snakePartTail2";
    part2.style.gridRow = 1;
    part2.style.gridColumn = 1;
    bigPart.appendChild(part2);

    snakeObjects[coord[0]][coord[1]].push(bigPart);
    bigPart.style.transform = "rotate(" + rotation + "deg)";
    board.appendChild(bigPart);
}
function AddSnakeHead(coord, rotation)
{
    var board = document.getElementById("snakeBoard");
    var bigPart = document.createElement("div");
    bigPart.style.width = 100 + "%";
    bigPart.style.height = 100 + "%";
    bigPart.style.display = "grid";
    bigPart.style.gridRow = coord[0];
    bigPart.style.gridColumn = coord[1];

    var part1 = document.createElement("div");
    part1.className = "snakePartTail1";
    part1.style.gridRow = 1;
    part1.style.gridColumn = 1;
    bigPart.appendChild(part1);

    var part2 = document.createElement("div");
    part2.className = "snakePartTail2";
    part2.style.gridRow = 1;
    part2.style.gridColumn = 1;
    bigPart.appendChild(part2);

    var part3 = document.createElement("div");
    part3.className = "snakeEye";
    part3.style.gridRow = 1;
    part3.style.gridColumn = 1;
    part3.style.marginLeft = 30 + '%';
    bigPart.appendChild(part3);

    var part4 = document.createElement("div");
    part4.className = "snakeEye";
    part4.style.gridRow = 1;
    part4.style.gridColumn = 1;
    part4.style.marginRight = 30 + '%';
    bigPart.appendChild(part4);

    snakeObjects[coord[0]][coord[1]].push(bigPart);
    bigPart.style.transform = "rotate(" + rotation + "deg)";
    board.appendChild(bigPart);
}
function AddBlockSquare(coord)
{
    var board = document.getElementById("snakeBoard");
    var block = document.createElement("div");
    block.className = "blockSquare";
    block.style.gridRow = coord[0];
    block.style.gridColumn = coord[1];
    snakeObjects[coord[0]][coord[1]].push(block);
    board.appendChild(block);
}
function DeleteCell(coord)
{
    if(snakeObjects[coord[0]][coord[1]].length == 0)
        return;

    var board = document.getElementById("snakeBoard");
    for(var i = 0; i < snakeObjects[coord[0]][coord[1]].length; i++)
        board.removeChild(snakeObjects[coord[0]][coord[1]][i]);
    
    snakeObjects[coord[0]][coord[1]] = [];
    var cell = document.createElement("square");
}

function GenerateCells ()
{
    var cell;
    var board = document.getElementById("snakeBoard");

    for(var i = 1; i <= 15; i++)
        for(var j = 1; j <= 15; j++)
        {
            cell = document.createElement("square");
            cell.style.gridColumn = i;
            cell.style.gridRow = j;
            board.appendChild(cell);
        }
}
window.onload = GenerateCells;

var direction = 0;
var lastDirection = 2;
var score = 0;
var dx = [0, 1, 0, -1], dy = [1, 0, -1, 0];
document.addEventListener(
    'keydown', 
    function(event) {
        if(event.keyCode == 65 && lastDirection != 0) 
            direction = 2;
        else if(event.keyCode == 87 && lastDirection != 1) 
            direction = 3;
        else if(event.keyCode == 68 && lastDirection != 2) 
            direction = 0;
        else if(event.keyCode == 83 && lastDirection != 3) 
            direction = 1;
    }
);

function SentNewScore()
{
    document.getElementById("updateScorInServer").value = score;
    document.getElementById("updateScor").submit();
}

function loadLevelSnake(level, nrLevel)
{
    var ecm = new EmptyCells();
    var snakePos = [];
    var blockCells = [];
    direction = 0;
    lastDirection = 2;

    for(var i = 1; i < level.length - 1; i++)
        for(var j = 1; j < level[i].length - 1; j++)
            if(level[i][j] === 0)
                ecm.pushInQueue([i, j]);
            else
            {
                AddBlockSquare([i, j]);
                blockCells.push([i, j]);
            }

    var coord = [8, 7];
    ecm.removeFromQueue(coord);
    snakePos.push(coord);
    level[coord[0]][coord[1]] = 2;
    AddSnakeTail(coord, -90);

    coord = [8, 8];
    ecm.removeFromQueue(coord);
    snakePos.push(coord);
    level[coord[0]][coord[1]] = 2;
    AddSnakeHead(coord, 90);

    var mar = ecm.getRandom();
    var levelMar = [-1, -1];
    level[mar[0]][mar[1]] = -1;
    AddStar(mar);

    var gameManager;
    var getBigger = false;
    var inGame = true;

    function stopLevel()
    {
        clearInterval(gameManager);
        while(snakePos.length > 0)
        {
            level[snakePos[0][0]][snakePos[0][1]] = 0;
            DeleteCell(snakePos[0]);
            snakePos.shift();
        }
        while(blockCells.length > 0)
        {
            DeleteCell(blockCells[0]);
            blockCells.shift();
        }
        level[mar[0]][mar[1]] = 0;
        DeleteCell(mar);

        if(levelMar[0] != -1 && levelMar[1] != -1)
        {
            level[levelMar[0]][levelMar[1]] = 0;
            DeleteCell(levelMar);
        }

        if(inGame == false)
        {
            var playButton = document.getElementById("playButton");
            playButton.style.visibility = 'visible';
            SentNewScore();
        }
    }

    function move()
    {  
        coord = [coord[0] + dx[direction], coord[1] + dy[direction]];
        lastDirection = direction;

        if(!getBigger)
        {
            level[snakePos[0][0]][snakePos[0][1]] = 0;
            ecm.pushInQueue(snakePos[0]);
            DeleteCell(snakePos[0]);
            snakePos.shift();
        }
        else
            getBigger = false;

        if(level[coord[0]][coord[1]] <= 0)
        {
            if(coord[0] == mar[0] && coord[1] == mar[1])
            {
                getBigger = true;
                DeleteCell(coord);
                mar = ecm.getRandom();
                level[mar[0]][mar[1]] = -1;

                if(snakePos.length <= Math.max(Math.floor((13 * 13 - blockCells.length) / 7), 14))
                {
                    score += (Math.floor(nrLevel / levelsSnake.length) + 1);
                    AddStar(mar, false);
                }
                else
                {
                    score += (Math.floor(nrLevel / levelsSnake.length) + 1) * 2;
                    AddStar(mar, true);
                }

                document.getElementById("textScore").innerText = "Score: " + score;

                if(snakePos.length == 15)
                {
                    levelMar = ecm.getRandom();
                    level[levelMar[0]][levelMar[1]] = 3;
                    AddLevelStar(levelMar);
                }
            }
            else
                ecm.removeFromQueue(coord);

            snakePos.push(coord);
            level[coord[0]][coord[1]] = 2;

            if(snakePos.length > 3)
            {
                DeleteCell(snakePos[snakePos.length - 2]);

                if(snakePos[snakePos.length - 3][0] == coord[0])
                    AddSnakeStraight(snakePos[snakePos.length - 2], 90);
                else if(snakePos[snakePos.length - 3][1] == coord[1])
                    AddSnakeStraight(snakePos[snakePos.length - 2], 0);
                else if((snakePos[snakePos.length - 3][0] + 1 == coord[0] && snakePos[snakePos.length - 3][1] + 1 == coord[1] &&
                snakePos[snakePos.length - 3][0] == snakePos[snakePos.length - 2][0]) || (snakePos[snakePos.length - 3][0] - 1 == coord[0] &&
                snakePos[snakePos.length - 3][1] - 1 == coord[1] && snakePos[snakePos.length - 3][1] == snakePos[snakePos.length - 2][1]))
                    AddSnakeChange(snakePos[snakePos.length - 2], 90);
                else if((snakePos[snakePos.length - 3][0] + 1 == coord[0] && snakePos[snakePos.length - 3][1] - 1 == coord[1] &&
                snakePos[snakePos.length - 3][1] == snakePos[snakePos.length - 2][1]) || (snakePos[snakePos.length - 3][0] - 1 == coord[0] && 
                snakePos[snakePos.length - 3][1] + 1 == coord[1] && snakePos[snakePos.length - 3][0] == snakePos[snakePos.length - 2][0]))
                    AddSnakeChange(snakePos[snakePos.length - 2], 180);
                else if((snakePos[snakePos.length - 3][0] - 1 == coord[0] && snakePos[snakePos.length - 3][1] + 1 == coord[1] &&
                snakePos[snakePos.length - 3][1] == snakePos[snakePos.length - 2][1]) || (snakePos[snakePos.length - 3][0] + 1 == coord[0] && 
                snakePos[snakePos.length - 3][1] - 1 == coord[1] && snakePos[snakePos.length - 3][0] == snakePos[snakePos.length - 2][0]))
                    AddSnakeChange(snakePos[snakePos.length - 2], 0);
                else
                    AddSnakeChange(snakePos[snakePos.length - 2], 270);
            }
            
            for(var k = 0; k < 4; k++)
                if(snakePos[snakePos.length - 2][0] + dx[k] == coord[0] &&
                snakePos[snakePos.length - 2][1] + dy[k] == coord[1])
                    AddSnakeHead(coord, (k + 1) * 90);
        }
        else
        {
            if(coord[0] != levelMar[0] || coord[1] != levelMar[1])
                inGame = false;

            stopLevel();
            if(inGame == true)
                loadLevelSnake(levelsSnake[(nrLevel + 1) % levelsSnake.length], nrLevel + 1);
        }

        if(snakePos.length > 0)
        {
            DeleteCell(snakePos[0]);
            for(var k = 0; k < 4; k++)
                if(snakePos[0][0] + dx[k] == snakePos[1][0] && snakePos[0][1] + dy[k] == snakePos[1][1])
                    AddSnakeTail(snakePos[0], (k - 1) * 90);
        }
        if(snakePos.length > 2)
        {
            DeleteCell(snakePos[1]);

            if(snakePos[0][0] == snakePos[2][0])
                AddSnakeStraight(snakePos[1], 90);
            else if(snakePos[0][1] == snakePos[2][1])
                AddSnakeStraight(snakePos[1], 0);
            else if((snakePos[0][0] + 1 == snakePos[2][0] && snakePos[0][1] + 1 == snakePos[2][1] &&
            snakePos[0][0] == snakePos[1][0]) || (snakePos[0][0] - 1 == snakePos[2][0] &&
            snakePos[0][1] - 1 == snakePos[2][1] && snakePos[0][1] == snakePos[1][1]))
                AddSnakeChange(snakePos[1], 90);
            else if((snakePos[0][0] + 1 == snakePos[2][0] && snakePos[0][1] - 1 == snakePos[2][1] &&
            snakePos[0][1] == snakePos[1][1]) || (snakePos[0][0] - 1 == snakePos[2][0] && 
            snakePos[0][1] + 1 == snakePos[2][1] && snakePos[0][0] == snakePos[1][0]))
                AddSnakeChange(snakePos[1], 180);
            else if((snakePos[0][0] - 1 == snakePos[2][0] && snakePos[0][1] + 1 == snakePos[2][1] &&
            snakePos[0][1] == snakePos[1][1]) || (snakePos[0][0] + 1 == snakePos[2][0] && 
            snakePos[0][1] - 1 == snakePos[2][1] && snakePos[0][0] == snakePos[1][0]))
                AddSnakeChange(snakePos[1], 0);
            else
                AddSnakeChange(snakePos[1], 270);
        }
    }

    gameManager = setInterval(move, Math.max(270 - (Math.floor(nrLevel / 5) * 30), 70));
}

function StartGame()
{
    var playButton = document.getElementById("playButton");
    playButton.style.visibility = 'hidden';
    loadLevelSnake(levelsSnake[0], 0);
    score = 0;
    document.getElementById("textScore").innerText = "Score: " + score;
}